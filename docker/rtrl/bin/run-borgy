#!/usr/bin/env bash

set -e # exit in case somethings fails
# set -x

for EXPID in "$@"; do
  EXP=$EXPERIMENTS/$EXPID
  python -m rtrl init_and_run "$EXP/spec.json" "$EXP/state" &>> "$EXP/output.txt" &
  echo training process writing to "$EXP/output.txt"
done

for EXPID in "$@"; do wait -n; done
echo all processes exited successfully


# test_run_borgy(){
#   mkdir /app/exp
#   export EXPERIMENTS=/app/exp
#   export BORGY_JOB_ID=63030777-c34f-47ef-9e5c-3058ebe1cf5a
#   mkdir /app/exp/e63030777_c34f_47ef_9e5c_3058ebe1cf5a_1
#   python -m rtrl spec 'partial(Training, epochs=2, Env=partial(id="Reacher-v2"))' /app/exp/e63030777_c34f_47ef_9e5c_3058ebe1cf5a_1/spec.json
#   run-borgy
# }